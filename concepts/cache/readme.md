
## 数据缓存
###### 动静分离
- 静态数据
  - 返回的数据，与用户特征、时间、地域等 无关。不管何时何人看到的都一样。

- 动态数据
  - 每个人看到的都不一样，需要根据用户特征等信息特殊处理返回的数据。

###### 缓存方案
- 把静态数据缓存到离用户最近的地方。
  - 用户浏览器、CDN 或者 服务端的 Cache中间件；




```JS
// 静态文件缓存
- Varnish

// 内存缓存
- Redis
```

###### 热点 Key
- 使用 Nginx 把请求的 URL 中的 item ID 进行Hash 并路由到一个 upstream中，这个upstream 挂载一个 Varnish 分组。这样，一个相同的 item 就可以随机访问一个分组的任意一台 Varnish 机器了。


## 缓存失效
- 被动失效，主要处理如模板变更和一些对时效性不太敏感数据的失效，采用设置一定时间长度（如只缓存 3 秒钟）这种自动失效的方式。当然，你也要开发一个后台管理界面，以便能够在紧急情况下手工失效某些 Cache。

- 主动失效，一般有 Cache 失效中心监控数据库表变化发送失效请求、系统发布也需要清空 Cache 数据等几种场景。失效中心会监控关键数据表的变更（有个中间件来解析 MySQL 的 binglog，然后发现有 Insert、Update、Delete 等操作时，会把变更前的数据以及要变更的数据转成一个消息发送给订阅方），通过这种方式来发送失效请求给 Cache，从而清除 Cache 数据。如果 Cache 数据放在 CDN 上，那么也可以采用类似的方式来设计级联的失效结构，采用主动发请求给 Cache 软件失效的方式。这种失效有失效中心将失效请求发送给每个 CDN 节点上的 Console 机，然后 Console 机来发送失效请求给每台 Cache 机器。
